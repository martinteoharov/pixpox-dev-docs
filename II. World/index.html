
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../I.%20Vision/" rel="prev"/>
<link href="../III.%20Storage/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.5.10" name="generator"/>
<title>II. World - PixPox Dev Docs</title>
<link href="../assets/stylesheets/main.7e359304.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#how-it-is-built">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="PixPox Dev Docs" class="md-header__button md-logo" data-md-component="logo" href=".." title="PixPox Dev Docs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            PixPox Dev Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              II. World
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="PixPox Dev Docs" class="md-nav__button md-logo" data-md-component="logo" href=".." title="PixPox Dev Docs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    PixPox Dev Docs
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../I.%20Vision/">
<span class="md-ellipsis">
    I. Vision
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    II. World
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    II. World
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-is-built">
<span class="md-ellipsis">
      How it is built
    </span>
</a>
<nav aria-label="How it is built" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#entities">
<span class="md-ellipsis">
      Entities
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components">
<span class="md-ellipsis">
      Components
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#systems">
<span class="md-ellipsis">
      Systems
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rust-type-system-integration">
<span class="md-ellipsis">
      Rust Type System integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../III.%20Storage/">
<span class="md-ellipsis">
    III. Storage
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../IV.%20Cellular%20Automaton/">
<span class="md-ellipsis">
    IV. Cellular Automaton
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Sources/">
<span class="md-ellipsis">
    Sources
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../TODO/">
<span class="md-ellipsis">
    TODO
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../V.%20Renderer/">
<span class="md-ellipsis">
    V. Renderer
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-is-built">
<span class="md-ellipsis">
      How it is built
    </span>
</a>
<nav aria-label="How it is built" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#entities">
<span class="md-ellipsis">
      Entities
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#components">
<span class="md-ellipsis">
      Components
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#systems">
<span class="md-ellipsis">
      Systems
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rust-type-system-integration">
<span class="md-ellipsis">
      Rust Type System integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>II. World</h1>
<p>For a summary of the concept, read <a href="../I.%20Vision/#entity-component-system">I. Vision#Entity Component System</a>.</p>
<p>The Entity Component System (ECS) is a powerful design pattern that facilitates the representation of a game world and its myriad of objects and algorithms, such as players, lights, terrain, physics, and more. An ECS comprises of entities, which are composed of components and lastly systems which operate on said entities.</p>
<p>By separating entities into their individual components, developers can create a flexible and high-performing logic that's perfect for complex game engines. This approach enables the creation of modular and extensible code that's easily modified and reused across various types of games.</p>
<p>The separation of components in an ECS also simplifies parallelization, which can result in improved performance. Because each system is responsible for processing one or more components, they can be run independently in parallel. This leads to increased CPU utilization and enhanced overall system performance.</p>
<h2 id="how-it-is-built">How it is built<a class="headerlink" href="#how-it-is-built" title="Permanent link">¶</a></h2>
<h3 id="entities">Entities<a class="headerlink" href="#entities" title="Permanent link">¶</a></h3>
<p>Entities are very simple. They are basically just a number - their ID. The EntityManager struct also includes methods for creating and deleting entities.</p>
<p><strong>Fields:</strong></p>
<ul>
<li>
<p>id</p>
<p>Each entity in the game world possesses a unique identifier. These IDs start from 0 and increment by 1 for every new entity that's created. At present, the ID value doesn't decrement on entity removal, as it's deemed unnecessary. In the future, a better implementation will utilize a queue data structure to retrieve the smallest possible ID for a new entity.</p>
</li>
</ul>
<h3 id="components">Components<a class="headerlink" href="#components" title="Permanent link">¶</a></h3>
<p>Components are stored in the world in a <code>Vec&lt;Box&lt;dyn ComponentVec&gt;&gt;</code> structure, which allows for efficient memory packing. This data structure is essentially a vector of heap-allocated vectors with additional custom logic attached to the inner vector.</p>
<p>// TODO: Clarify this &amp; Make sure it makes complete sense
One advantage of this approach is that it enables us to optimize memory usage by packing data tightly into the smallest amount of memory required. This is achieved by organizing the components in memory so that there are no gaps between them, which reduces the amount of unused space in memory. In addition, the use of heap-allocated vectors allows for easy dynamic allocation and modification of components as needed during runtime.</p>
<p>As a developer using PixPox, you have the freedom to create custom components. However, it is essential that these components implement specific traits so that they are accepted by the engine.</p>
<pre><code class="language-rust">pub trait Label {
    fn label(&amp;mut self) -&gt; &amp;'static str;
}

pub trait Run {
    fn run(&amp;mut self, storage: &amp;Storage);
}

pub trait Update {
    fn update(&amp;mut self, storage: &amp;RwLock&lt;Storage&gt;);
}
</code></pre>
<p>The <code>Label</code> trait requires that every component has a <code>label()</code> method that prints out its type. This is useful for debugging purposes.</p>
<p>The <code>Run</code> trait specifies a <code>run()</code> method that is executed for each component whenever <code>world.run()</code> is called. This function is parallelized using multi-threading and only has read access to the storage. It is designed for heavy computation, and no updates are allowed.</p>
<p>The <code>Update</code> trait specifies an <code>update()</code> method, which much like <code>run()</code>  is executed on every pass of <code>world.run()</code>. It is also parallelized, but its given a <code>RwLock</code> instead of an immutable reference. This method is meant to update the world when a change is present, and it should not attempt to obtain a <code>.write()</code> lock on the storage when no changes are present, as doing so would adversely impact performance.</p>
<h3 id="systems">Systems<a class="headerlink" href="#systems" title="Permanent link">¶</a></h3>
<p>In PixPox, systems are incorporated as part of the component. Every component features two mandatory system functions: <code>Run()</code> and <code>Update()</code> as discussed in the above section. During the <code>world.run()</code> call, both functions are executed.</p>
<p>Firstly, <code>Run()</code> is called on all components, with an immutable reference to the storage. It's important to note that the <code>Run()</code> method is not allowed to modify anything in the global storage. This approach is necessary because the <code>Run()</code> calls are parallelized.</p>
<p>Once all <code>Run()</code> methods have been executed, <code>Update()</code> is called on each component, with a reference to a <code>RWLock</code> that's distilled into a reference of write-access to the storage. The philosophy of the <code>Update()</code> function is all about updating the global storage. As such, it shouldn't contain any computationally intensive code.</p>
<p>Overall, this design ensures that all the components are processed and updated efficiently in parallel, while also safeguarding the integrity of the global storage.</p>
<h3 id="rust-type-system-integration">Rust Type System integration<a class="headerlink" href="#rust-type-system-integration" title="Permanent link">¶</a></h3>
<p>There are many reasons why Rust is a fantastic language, one of which is its robust type system that introduces "Traits".</p>
<p>In Rust, a trait is a feature that defines a set of methods that a type can implement. It is similar to interfaces in other programming languages, but with additional capabilities and flexibility.</p>
<p>Traits provide a way to define shared behavior across different types. By implementing a trait, a type can guarantee that it has certain properties or capabilities, which allows it to be used in a more generic way. For example, the <code>ToString</code> trait can be implemented by any type that can be converted to a string, such as integers or custom structures.</p>
<p>Additionally, traits can be used to define default behavior for types, enabling more efficient and concise code. They can also be used to enable dynamic dispatch, which is useful for building more modular and extensible code. </p>
<p>In our implementation, Traits play an essential role in determining what can be a Component. For a Component to be valid, it must implement the Traits Run, Update, and Label. Additionally, a Component can optionally implement Texture, but we will discuss that later.</p>
<p>In the ECS, a "Component" can be assigned to an entity by first creating a Component Type. Once the Component Type is defined, a variable of that type can be initialized and passed to the helper method <code>World::add_component_to_entity()</code>, which attaches the component to the entity.</p>
<p>To ensure that each entity has its own copy of the Component, we require the trait Copy, as we cannot have a reference to a single component in memory for every entity. By making Components Copy-able, we can create unique instances for each entity that has the Component attached to it.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
<script src="../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>